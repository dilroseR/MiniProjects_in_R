---
title: "Mini Project 2: Exploring Data"
author: Dilrose Karakattil
date: October 12, 2023
format:
  html:
    toc: true
    theme: flatly
---

```{r}
#| label: setup
#| include: false

knitr::opts_chunk$set(
    warning = FALSE,
    message = FALSE,
    fig.path = "figs/", # Folder where rendered plots are saved
    fig.width = 7.252, # Default plot width
    fig.height = 4, # Default plot height
    fig.retina = 3, # For better plot resolution
    comment = "#>"
)

# Load libraries
library(tidyverse)
library(readxl)
library(here)
library(janitor)
library(ggplot2)
library(cowplot)
```

# 1. Load the data

```{r}
df <- read_csv(here("data", "transit_cost.csv"), show_col_types = FALSE)
```

# 2. Document the data

**Data file name:** transit_cost.csv

**Original Source:** https://transitcosts.com/

**Source of downloaded file:** https://github.com/rfordatascience/tidytuesday/tree/master/data/2021/2021-01-05

**Description:** The data contains the costs of hundreds of transit projects around the world collected by the Transit Costs Project. The data span more than 50 countries and totals more than 11,000 km of urban rail built since the late 1990s. 

**Dictionary of data file:**

- e : ID
- country : Country Code
- city : City where transit tunnel is being created
- line : Line name or path
- start_year : Year started
- end_year : Year ended (predicted or actual)
- rr : Railroad (0 or 1), where 1 == Railroad?
- length : Length of proposed line in km
- tunnel_per : Percent of line length completed
- tunnel : Tunnel length of line completed in km
- stations : Number of stations where passengers can board/leave
- source1 : Where was data sourced
- cost : Cost in millions of local currency
- currency : Currency type
- year : Midpoint year of construction
- ppp_rate : purchasing power parity (PPP), based on the midpoint of construction
- real_cost	: Real cost in Millions of USD
- cost_km_millions : Cost/km in millions of USD
- source2 :Where was data sourced for cost
- reference : Reference URL for source


# 3. Preview the data

```{r}
glimpse(df)
head(df)
```

# 4. Identify research questions

1. Question 1 - Which decade has the greatest number of completed projects (predicted or actual)? 
2. Question 2 - Which city in the United States has the highest cost to build a transit tunnel?
3. Question 3 - Which transit line name in the United States has the highest cost to build?

# 5. Explore the data


## Exploring Question 1
```{r}
#Make the data frame
df %>% 
    group_by(end_year) %>% 
    mutate(end_year = as.factor(end_year),
        end_year = fct_collapse(end_year, 
                "1980 - 1990" = c("1987"),
                "1991 - 2000" = c("1994","1995","1998","1999","2000"),
                "2001 - 2010" = c("2002","2003","2004","2005","2006","2007","2008","2009","2010"),
                "2011 - 2020" = c("2011","2012","2013","2014","2015","2016","2017","2018","2019","2020"),
                "2021 - 2030" = c("2021","2022","2023","2024","2025","2026","2027","2028","2029","2030")),
        end_year = fct_recode(end_year, "Not determined" = "X")
        ) %>% 
    filter(!is.na(end_year)) %>% 
    count() %>% 
    # Make the plot
    ggplot(aes(x = n, y = end_year), width = 0.7) +
    geom_col() +
    geom_text(aes(label = n), colour = "black", hjust = -0.2, size = 3) +
    scale_x_continuous(
    expand = expansion(mult = c(0, 0.05))) + 
    labs(
        x = "Count",
        y = "Year Ended (predicted or actual)",
        title = "Count of transit projects completed in each decade",
        subtitle = "Decade 2021-2030 has the highest count of completed projects"
    ) +
    theme(legend.position = 'none') +
    theme_minimal_vgrid()
    
# Save the ggplot to a file using ggsave
ggsave("figs/question1.png", width = 6, height = 4, dpi = 300)
```
According to the graph above, from 2021 to 2030, about 212 transit tunnel projects will be finished, with the second largest being 208 completed projects from 2011 to 2020, followed by 39 completed projects from 2001 to 2010 and 10 completed projects from 1991 to 2000. From 1980 through 1990, the smallest number of projects completed was one.


<br>

## Exploring Question 2
```{r}
df1 <- df %>% 
    filter(country == "US")

df1 %>% 
    group_by(city) %>% 
    mutate(
        real_cost = as.double(real_cost)
    ) %>% 
    arrange(desc(real_cost)) %>% 
    ggplot() +
    geom_col(aes(x = real_cost, y = reorder(city, real_cost))) +
    scale_x_continuous(
    expand = expansion(mult = c(0, 0.05))) +
    scale_fill_manual(values = c('grey', 'steelblue')) +
    theme_minimal_vgrid() +
    theme(legend.position = 'none') +
    labs(
        x = "Cost (in millions of USD)",
        y = "City",
        title = "Cost incurred for each city in US",
        subtitle = "New York city has the highest construction costs for transit line tunnels"
        )

# Save the ggplot to a file using ggsave
ggsave("figs/question2.png", width = 6, height = 4, dpi = 300)
```
According to the graph above, New York will incur the highest amount of costs for developing transit tunnels in the United States, followed by San Jose and Los Angeles. 

<br>

## Exploring Question 3
```{r}
df1 %>% 
    ggplot() +
    geom_segment(
    aes(x = 0, xend = cost, y = line, yend = line), color = 'grey') +
    geom_point(aes(x = cost, y = line), size = 2.5, color = 'steelblue') +
    theme_minimal_vgrid() +
    theme(legend.position = 'none') +
    labs(
        x = "Cost (in millions of USD)",
        y = "Line Name", 
        title = "Cost of constructing each line in the United States"
    )

# Save the ggplot to a file using ggsave
ggsave("figs/question3.png", width = 6, height = 4, dpi = 300)
```
According to the graph above, there are 13 lines in the United States where transit tunnels are scheduled to be built, with the "East Side Access" line costing the most to build, followed by the "Gateway" and "BART" lines.

<br>

# Bonus

Let's create a log-log plot for the variables - real_cost and length of the proposed line.

```{r}
# convert real_cost to double format
df %>% 
    mutate(
        real_cost = as.double(real_cost)
    ) %>% 
    filter(!is.na(real_cost)) %>% 
    # make a scatter plot
    ggplot(aes(x = log(real_cost), y = log(length)), width = 0.9) +
    geom_point() +
    labs(
        x = "Log of real cost",
        y = "Log of length of proposed line",
        title = "Log-log plot"
    ) + 
    theme_minimal()

# Save the ggplot to a file using ggsave
ggsave("figs/bonus.png", width = 6, height = 4, dpi = 300)
```
The graph above shows that there is a logical relationship between the cost of building the line and its length.